<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MOVIE RECOMMENDER</title>

    <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  </head>

  <body>
    <h1>MOVIE RECOMMENDER</h1>


<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">Navbar</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Dropdown
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
    <div class="dropdown m-4">
        <button class="btn btn-secondary 
                       dropdown-toggle" 
                type="button" 
                id="dropdownMenuButton1" 
                data-bs-toggle="dropdown" 
                aria-expanded="false">
            search
        </button>
        <ul class="dropdown-menu pt-0" 
            aria-labelledby="dropdownMenuButton1">
            <input type="text" 
                   class="form-control 
                          border-0 border-bottom 
                          shadow-none mb-2" 
                   placeholder="Search..." 
                   oninput="handleInput()">
        </ul>
    </div>
  </div>
</nav>


<!-- 
{% if poster_url %}
   <img src="{{ poster_url }}" alt="Movie poster">
{% else %}
   <p>Poster not available</p>
{% endif %} -->





<!-- <style>
  .poster-wrapper {
    width: 262px;          /* full column width */
    height: 380px;        /* smaller fixed height (change as needed) */
    overflow: hidden;
  }

  .poster-img {
    width: 100%;
    height: 100%;
    object-fit: cover;    /* fills box, keeps aspect ratio, crops excess */
    display: block;
  }
  /* Remove space between posters (columns) */
  .poster-col {
    padding-left: 1px;
    padding-right: 1px;
  }
  .movie-card {
    width: 220px;          /* fixed column width */
    display:block;
  }
</style> -->

<style>
.poster-wrapper {
  width:220px;
  height: 320px;
  overflow: hidden;
}
.poster-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.movie-card { text-align: left; }
</style>   

<h1>bdcbjreg</h1>



<div id="carousel1" class="carousel slide">
  <div class="carousel-inner">


    <div id="carousel1" class="carousel slide">
  <div class="carousel-inner">

    {% set slides = (trending|length + 5) // 6 %}

    {% for i in range(slides) %}
      <div class="container-fluid text-center carousel-item {% if i == 0 %}active{% endif %}">
        <div class="row">
        
{% for movie in trending[6*i:6*i+6] %}
  <div class="col-6 col-md-4 col-lg-2 poster-col" id="card-main-{{ movie.name|replace(' ', '_') }}">
    <div class="movie-card">
      <button type="button" class="btn btn-success mt-2 watchlist-btn"
              data-movie="{{ movie.name }}">
        Watchlist +
      </button>
      <div class="poster-wrapper mt-1">
        <img src="{{ movie.poster_url }}" class="poster-img" alt="{{ movie.name }}">
      </div>
      <div class="movie-title">
        {{ movie.name }}
      </div>
    </div>
  </div>
{% endfor %}


        </div>
      </div>
    {% endfor %}

  </div>

  <button class="carousel-control-prev" type="button" data-bs-target="#carousel1" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carousel1" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

  </div>
</div>




<h1>watchlist</h1>


<div id="carousel2" class="carousel slide">
  <div class="carousel-inner">


    <div id="carousel2" class="carousel slide">
  <div class="carousel-inner">

    {% set slides = (watchlist|length + 5) // 6 %}

    {% for i in range(slides) %}
      <div class="container-fluid text-center carousel-item {% if i == 0 %}active{% endif %}">
        <div class="row">
        
{% for movie in watchlist[6*i:6*i+6] %}
  <div class="col-6 col-md-4 col-lg-2 poster-col"
       id="card-watchlist-{{ movie.movie_name|replace(' ', '_') }}">
    <div class="movie-card">
      <button type="button" class="btn btn-danger mt-2 watchlist-btn"
              data-movie="{{ movie.movie_name }}">
        Remove -
      </button>
      <div class="poster-wrapper mt-1">
        <img src="{{ movie.watchlist_poster_url }}" class="poster-img" alt="{{ movie.movie_name }}">
      </div>
      <div class="movie-title">
        {{ movie.movie_name }}
      </div>
    </div>
  </div>
{% endfor %}



        </div>
      </div>
    {% endfor %}

  </div>

  <button class="carousel-control-prev" type="button" data-bs-target="#carousel2" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carousel2" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

  </div>
</div>

<h1>RECOMMENDER</h1>



<div id="carousel3" class="carousel slide">
  <div class="carousel-inner">


    <div id="carousel3" class="carousel slide">
  <div class="carousel-inner">

    {% set slides = (recommended_watchlist_movies|length + 5) // 6 %}

    {% for i in range(slides) %}
      <div class="container-fluid text-center carousel-item {% if i == 0 %}active{% endif %}">
        <div class="row">
        
{% for movie in recommended_watchlist_movies[6*i:6*i+6] %}
  <div class="col-6 col-md-4 col-lg-2 poster-col" id="card-main-{{ movie.rec_movie_name|replace(' ', '_') }}">
    <div class="movie-card">
      <button type="button" class="btn btn-success mt-2 watchlist-btn"
              data-movie="{{ movie.rec_movie_name }}">
        Watchlist +
      </button>
      <div class="poster-wrapper mt-1">
        <img src="{{ movie.recommended_poster_url }}" class="poster-img" alt="{{ movie.rec_movie_name }}">
      </div>
      <div class="movie-title">
        {{ movie.rec_movie_name }}
      </div>
    </div>
  </div>
{% endfor %}


        </div>
      </div>
    {% endfor %}

  </div>

  <button class="carousel-control-prev" type="button" data-bs-target="#carousel3" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carousel3" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

  </div>
</div>

<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- <script>
document.addEventListener('DOMContentLoaded', function() {
  const watchlist = {{ watchlist | tojson }};
  
  // Set initial button states
  document.querySelectorAll('.watchlist-btn').forEach(btn => {
    const movieName = btn.dataset.movie;
    if (watchlist.includes(movieName)) {
      btn.innerHTML = 'Remove -';
      btn.className = 'btn btn-danger mt-2 watchlist-btn';
    }
    
    // Add click handler
    btn.addEventListener('click', function() {
      const movieName = this.dataset.movie;
      const btn = this;
      
      fetch('/toggle_watchlist', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'movie_name=' + encodeURIComponent(movieName)
      })
      .then(response => response.json())
      .then(data => {
        if (data.in_watchlist) {
          btn.innerHTML = 'Remove -';
          btn.className = 'btn btn-danger mt-2 watchlist-btn';
        } else {
          btn.innerHTML = 'Watchlist +';
          btn.className = 'btn btn-success mt-2 watchlist-btn';
        }
      });
    });
  });
});
</script> -->



<script>
document.addEventListener('DOMContentLoaded', function() {
  const watchlist = {{ watchlist | tojson }};
  const watchlistNames = watchlist.map(item => item.movie_name);
  const trending = {{ trending | tojson }};

  function updateButtonsFor(movieName, inWatchlist) {
    document.querySelectorAll('.watchlist-btn[data-movie="' + movieName + '"]')
      .forEach(b => {
        if (inWatchlist) {
          b.textContent = 'Remove -';
          b.classList.remove('btn-success');
          b.classList.add('btn-danger');
        } else {
          b.textContent = 'Watchlist +';
          b.classList.remove('btn-danger');
          b.classList.add('btn-success');
        }
      });
  }

  function getPosterUrl(movieName) {
    const m = trending.find(item => item.name === movieName);
    return m ? m.poster_url : '';
  }

  function createWatchlistCard(movieName, posterUrl) {
    const col = document.createElement('div');
    col.className = 'col-6 col-md-4 col-lg-2 poster-col';
    col.id = 'card-watchlist-' + movieName.replace(/\s+/g, '_');

    col.innerHTML = `
      <div class="movie-card">
        <button type="button" class="btn btn-danger mt-2 watchlist-btn"
                data-movie="${movieName}">
          Remove -
        </button>
        <div class="poster-wrapper mt-1">
          <img src="${posterUrl}" class="poster-img" alt="${movieName}">
        </div>
        <div class="movie-title">
          ${movieName}
        </div>
      </div>
    `;
    return col;
  }

  // set initial state for all existing buttons
  document.querySelectorAll('.watchlist-btn').forEach(btn => {
    const movieName = btn.dataset.movie;
    if (watchlistNames.includes(movieName)) {
      updateButtonsFor(movieName, true);
    }
  });

  // EVENT DELEGATION: works for existing and future .watchlist-btn
  document.addEventListener('click', function(e) {
    const btn = e.target.closest('.watchlist-btn');
    if (!btn) return;

    const name = btn.dataset.movie;

    fetch('/toggle_watchlist', {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: 'movie_name=' + encodeURIComponent(name)
    })
    .then(res => res.json())
    .then(data => {
      const inWatchlist = data.in_watchlist;
      const cardId = 'card-watchlist-' + name.replace(/\s+/g, '_');
      const existingCard = document.getElementById(cardId);
      const activeWatchlistRow = document.querySelector('#carousel2 .carousel-item.active .row');

      // update all buttons (both carousels)
      updateButtonsFor(name, inWatchlist);

      if (inWatchlist) {
        // add to watchlist carousel if not there yet
        if (!existingCard && activeWatchlistRow) {
          const posterUrl = getPosterUrl(name);
          if (posterUrl) {
            const newCard = createWatchlistCard(name, posterUrl);
            activeWatchlistRow.appendChild(newCard);
          }
        }
      } else {
        // remove from watchlist carousel
        if (existingCard) existingCard.remove();
      }
    });
  });
});
</script>








</body>
</html>